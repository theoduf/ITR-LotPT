/*
 * Copyright (c) 2018 Erik Nordstr√∏m <erik@nordstroem.no>
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
*/
var aa="function"==typeof Object.create?Object.create:function(a){function b(){}b.prototype=a;return new b},k;if("function"==typeof Object.setPrototypeOf)k=Object.setPrototypeOf;else{var l;a:{var ba={O:!0},m={};try{m.__proto__=ba;l=m.O;break a}catch(a){}l=!1}k=l?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var n=k;
function p(a,b){a.prototype=aa(b.prototype);a.prototype.constructor=a;if(n)n(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.T=b.prototype}var ca="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},q="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;
function r(){r=function(){};q.Symbol||(q.Symbol=da)}var da=function(){var a=0;return function(b){return"jscomp_symbol_"+(b||"")+a++}}();function t(){r();var a=q.Symbol.iterator;a||(a=q.Symbol.iterator=q.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&ca(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return u(this)}});t=function(){}}function u(a){var b=0;return ea(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})}
function ea(a){t();a={next:a};a[q.Symbol.iterator]=function(){return this};return a}function v(a){t();var b=a[Symbol.iterator];return b?b.call(a):u(a)};function w(){this.g=!1;this.c={};this.b={};this.f={};this.a=void 0}function x(a,b){var c=y;if(c.c.hasOwnProperty(a))throw"State "+a+" has already been registered!";b.i=c;c.c[a]=b;c.b[a]={}}
function z(a,b,c,d){var g=y;if(g.c.hasOwnProperty(a))if(g.c.hasOwnProperty(c)){if(g.b.hasOwnProperty(a)&&g.b[a].hasOwnProperty(b))throw"State transition event "+b+" from state "+a+" has already been registered!";g.b[a][b]={next_statename:c,call_f:d}}else throw"State "+c+" has not been registered!";else throw"State "+a+" has not been registered!";}w.prototype.C=function(a,b){for(var c=v(Object.keys(this.c)),d=c.next();!d.done;d=c.next())this.c[d.value].C(a,b)};
w.prototype.h=function(){if(this.g)throw"State machine is already running!";this.g=!0;this.c[this.a].h()};function A(a,b,c){console.log("State machine was informed of an event:",b,c);if(a.b[a.a].hasOwnProperty(b)){var d=a.b[a.a][b].call_f;a.a=a.b[a.a][b].next_statename;d(c)}else console.log("State machine does not know where to send this event "+("given its current state "+a.a+"."))};function B(){this.B=this.A=this.i=void 0;this.c=!1;this.b={}}B.prototype.C=function(a,b){this.A=a;this.B=b};B.prototype.M=function(){};B.prototype.F=function(){};B.prototype.h=function(){for(var a=v(Object.keys(this.b)),b=a.next();!b.done;b=a.next())b=b.value,window.addEventListener(b,this.b[b]);this.c=!0;this.F()};B.prototype.stop=function(){for(var a=v(Object.keys(this.b)),b=a.next();!b.done;b=a.next())b=b.value,window.removeEventListener(b,this.b[b]);this.c=!1};
function C(){B.call(this);this.f=void 0}p(C,B);C.prototype.a=function(){};C.prototype.h=function(){for(var a=v(Object.keys(this.b)),b=a.next();!b.done;b=a.next())b=b.value,window.addEventListener(b,this.b[b]);this.c=!0;this.a()};C.prototype.stop=function(){window.cancelAnimationFrame(this.f);this.f=null;B.prototype.stop.call(this)};function D(a){C.call(this);this.m=a}p(D,C);
function fa(a){function b(a,b){g[a][b]=d[a][b];delete d[a][b];0===Object.keys(d[a]).length&&delete d[a];delete this.m[a][b];0===Object.keys(this.m[a]).length&&delete this.m[a];0===Object.keys(this.m).length&&(this.stop(),A(this.i,"resources_loaded",g))}function c(a,b){this.stop();A(this.i,"resource_failed_to_load",{resource_type:a,resource_key:b})}for(var d={},g={},e=v(Object.keys(a.m)),f=e.next();!f.done;f=e.next()){f=f.value;d[f]={};g[f]={};f=v(Object.keys(a.m[f]));for(var h=f.next();!h.done;h=
f.next());}e={};f=v(Object.keys(a.m.image));for(h=f.next();!h.done;e={w:e.w},h=f.next())e.w=h.value,h=new Image,d.image[e.w]=h,h.onload=function(c){return function(){b.bind(a)("image",c.w)}}(e),h.onerror=function(b){return function(){c.bind(a)("image",b.w)}}(e),h.src=a.m.image[e.w]}D.prototype.a=function(){this.c&&(this.f=window.requestAnimationFrame(this.a.bind(this)))};D.prototype.h=function(){this.c=!0;fa(this);this.f=window.requestAnimationFrame(this.a.bind(this))};function E(){C.call(this);var a=this;this.g=void 0;this.b={touchend:function(){a.stop();A(a.i,"start_game",a.g)},mouseup:function(b){1===b.which&&(a.stop(),A(a.i,"start_game",a.g))},keyup:function(b){" "===b.key&&(a.stop(),A(a.i,"start_game",a.g))}}}p(E,C);E.prototype.H=function(a){this.g=a};
E.prototype.a=function(){var a=this.A,b=this.B;b.fillStyle="#000";b.fillRect(0,0,a.width,a.height);b.font="12pt sans-serif";b.textAlign="center";b.textBaseline="middle";b.fillStyle="#fff";b.fillText("Touch screen, click primary mouse button or press spacebar to start game.",a.width/2,a.height/2);this.c&&(this.f=window.requestAnimationFrame(this.a.bind(this)))};
function F(){C.call(this);var a=this;this.l=this.G=this.g=void 0;this.b={focus:function(){a.l&&(a.stop(),A(a.i,"resume_game"))},touchend:function(){a.stop();A(a.i,"resume_game")},mouseup:function(b){1===b.which&&(a.stop(),A(a.i,"resume_game"))},keyup:function(b){"Escape"===b.key&&(a.stop(),A(a.i,"resume_game"))}}}p(F,C);
F.prototype.a=function(){if(this.g.D.L)this.f=window.requestAnimationFrame(this.a.bind(this));else{this.g.D.K();var a=this.A,b=this.B;b.fillStyle="rgba(64, 64, 128, 0.45)";b.fillRect(0,0,a.width,a.height);b.fillStyle="#ffffff";var c=.05*a.height;b.fillRect(c,c,c,2.5*c);b.fillRect(2.5*c,c,c,2.5*c);b.font="12pt sans-serif";b.textAlign="center";b.textBaseline="middle";b.fillStyle="#fff";this.l?b.fillText("Bring game window back in focus to resume game.",a.width/2,a.height/2):b.fillText("Touch screen, click primary mouse button or press escape to resume game.",
a.width/2,a.height/2)}};F.prototype.M=function(){this.a()};F.prototype.h=function(){this.G=document.title;document.title="Paused - "+this.G;C.prototype.h.call(this)};F.prototype.stop=function(){document.title=this.G;C.prototype.stop.call(this)};function G(){C.call(this)}p(G,C);G.prototype.a=function(){this.c&&(this.f=window.requestAnimationFrame(this.a.bind(this)))};function H(){this.A=this.l=this.g=this.f=void 0;this.o=this.j=0;this.L=!1}H.prototype.H=function(){};H.prototype.C=function(a,b){this.f=a;this.g=b};H.prototype.v=function(){};H.prototype.N=function(){};H.prototype.K=function(){};function I(a){H.call(this,a);this.F=Math.acos(0);this.B=this.c=this.b=this.a=void 0}p(I,H);I.prototype.v=function(){H.prototype.v.call(this);this.a=this.f.height/30;this.b=this.f.width/2;this.c=this.f.height/2;this.B=Math.min(Math.max(this.f.height/200,.75),1)*this.f.scale};
I.prototype.N=function(a){this.A=this.o;this.l=this.j;this.o=a.o;this.j=a.j};function J(a,b){return Math.cos(a.F*b/48)}
I.prototype.K=function(){this.L=!0;var a=this.f,b=this.g;b.clearRect(0,0,a.width,a.height);a=48/Math.PI;if(this.o%1!==this.A%1||this.j%a!=this.l%a){b.fillStyle="#449";b.strokeStyle="#0ff";b.lineWidth=this.B;var c=-24*J(this,-24),d=this.b+c*this.a;c=this.b-c*this.a;var g=this.f.height;b.fillRect(d,0,c-d,g);b.beginPath();b.moveTo(d,0);b.lineTo(d,g);b.stroke();b.beginPath();b.moveTo(c,0);b.lineTo(c,g);b.stroke();for(d=0;53.5>d;d++){c=26.25-d-this.o%2;var e=J(this,-24);g=this.b+-24*e*this.a;e=this.c-
c*e*this.a;b.beginPath();b.moveTo(g,e);for(e=0;49>e;e++){var f=-24+e,h=J(this,f);b.lineTo(this.b+h*f*this.a,this.c-h*c*this.a)}b.stroke();b.beginPath();f=-23+(d%2?0:1)-this.j/a%2;e=J(this,f);f=this.b+e*f*this.a;f>g&&(g=this.c-e*(c-1)*this.a,b.moveTo(f,this.c-e*c*this.a),b.lineTo(f,g));for(g=2;48>g;g+=2)f=-24+g+(d%2?1:0)-this.j/a%2,e=J(this,f),f=this.b+e*f*this.a,h=this.c-e*(c-1)*this.a,b.moveTo(f,this.c-e*c*this.a),b.lineTo(f,h);e=25-(d%2?1:0)-this.j/a%2;g=J(this,e);e=this.b+g*e*this.a;e<this.b+24*
g*this.a&&(f=this.c-g*c*this.a,b.moveTo(e,this.c-g*(c+1)*this.a),b.lineTo(e,f));b.stroke()}}this.L=!1};function K(){this.o=this.j=0;this.s=Math.PI/16;this.u=.05;this.P=Math.PI/8;this.S=.01;this.I=Math.PI/2;this.J=.25}function L(){K.call(this)}p(L,K);function M(){B.call(this);var a=this;this.b={blur:function(){a.stop();A(a.i,"blur_paused_game",a)},keyup:function(b){"Escape"===b.key&&(a.stop(),A(a.i,"user_paused_game",a))}};this.a={third_person_side_view_camera:new I(this)};this.g=new L;this.R=[this.g];this.D=this.a.third_person_side_view_camera;this.l=void 0;this.G=Array(240);this.f=void 0}p(M,B);M.prototype.H=function(a){for(var b=v(Object.keys(this.a)),c=b.next();!c.done;c=b.next())this.a[c.value].H(a)};
M.prototype.C=function(a,b){for(var c=v(Object.keys(this.a)),d=c.next();!d.done;d=c.next())this.a[d.value].C(a,b)};M.prototype.v=function(){this.D.v()};M.prototype.M=function(){this.v()};
M.prototype.F=function(){var a=Date.now();if(this.c){var b=this.l,c=this.G,d=0;void 0!==b&&(d=a-b,c.shift(),c.push(d));b=v(this.R);for(c=b.next();!c.done;c=b.next())c=c.value,c.s+=c.P*d/1E3,c.s>c.I?c.s=c.I:c.s<-c.I&&(c.s=-c.I),c.j+=c.s,c.u+=c.S*d/1E3,c.u>c.J?c.u=c.J:c.u<-c.J&&(c.u=-c.J),c.o+=c.u;this.D.N(this.g);this.D.K();this.l=a;this.f=window.requestAnimationFrame(this.F.bind(this))}};M.prototype.stop=function(){window.cancelAnimationFrame(this.f);B.prototype.stop.call(this)};var y=new w,N=new D({image:{"sun.svg":"assets/thirdparty/images/sun.svg"}});x("loading_resources",N);var O=new E;x("main_menu",O);z("loading_resources","resources_loaded","main_menu",function(a){O.H(a);O.h()});var P=new G;x("critical_error",P);z("loading_resources","resource_failed_to_load","critical_error",function(){P.h()});z("critical_error","restart","loading_resources",N.h);var Q=new M;x("in_game",Q);
z("main_menu","start_game","in_game",function(a){Q.H(a);a=y;console.log(a.b);if(a.b.hasOwnProperty("main_menu")&&a.b.main_menu.hasOwnProperty("start_game"))delete a.b.main_menu.start_game;else throw"State transation event start_game from state main_menu does not exist!";z("main_menu","start_game","in_game",Q.h);Q.v();Q.h()});var R=new F;x("game_paused",R);z("in_game","user_paused_game","game_paused",function(a){R.g=a;R.l=!1;R.h()});
z("in_game","blur_paused_game","game_paused",function(a){R.g=a;R.l=!0;R.h()});z("game_paused","resume_game","in_game",function(){Q.h()});var S=y;if(S.c.hasOwnProperty("loading_resources"))S.a="loading_resources";else throw"State loading_resources has not been registered!";
function T(a){var b=window.devicePixelRatio;if(window.innerWidth>16*window.innerHeight/10){var c=window.innerHeight;var d=16*c/10}else d=window.innerWidth,c=10*d/16;a.style.width=Math.floor(d)+"px";a.style.height=Math.floor(c)+"px";a.width=d*b;a.height=c*b}
for(var U=v(Object.keys(y.c)),V=U.next();!V.done;V=U.next())for(var ha=V.value,ia=y.c[ha],ja={did_resize:ia.M.bind(ia)},ka=v(Object.keys(ja)),W=ka.next();!W.done;W=ka.next()){var la=W.value,X=y,Y=ha,Z=la,ma=ja[la];X.f.hasOwnProperty(Y)||(X.f[Y]={});if(X.f[Y].hasOwnProperty(Z))throw"Handler for external event "+Z+" has already been "+("registered for state "+Y+"!");X.f[Y][Z]=ma}
window.addEventListener("load",function(){function a(){T(b);var a=y;console.log("State machine was informed of an external event:","did_resize");a.f.hasOwnProperty(a.a)&&a.f[a.a].hasOwnProperty("did_resize")?(0,a.f[a.a].did_resize)():console.log("Current state "+a.a+" does not have the handler required for this event.")}var b=document.getElementById("game"),c=b.getContext("2d");T(b);c.fillStyle="#fff";c.fillRect(0,0,b.width,b.height);b.hidden=!1;y.C(b,c);var d;window.addEventListener("resize",function(){clearTimeout(d);
d=setTimeout(a,30)});var g;window.addEventListener("orientationchange",function(){clearTimeout(g);g=setTimeout(a,250)});y.h()});//# sourceMappingURL=main.map
